# kurisaba
A nullchan-kusabaX based imageboard engine with some modern features

## Установка

Этот процесс пока что не проверялся, но всё должно выглядеть так.

Если кто-то захочет развернуть курисабу у себя с нуля и поделится с нами своим опытом, например, в виде написания issue-в на github - мы будем очень рады.

- Скопировать шаблон config.php.template из каталога template в корень борды, поправить в нём необходимые поля (они все собраны в одном помеченном соответствующими словами месте).
- Создать базу данных с любым названием (если ещё не создана).
- Импортировать файл database.sql в эту базу.
- Добавить пользователя-админа в таблицу staff.
- Создать каталоги tmp, tmp/dwoo (настраивается в конфиге), tmp/xhrupload. Они должны быть доступны для записи веб-серверу. Можно удалить каталог _templates.
- После этого можно заходить в админку (http://example.com/manage.php) и создавать секции (по умолчанию определена секция "борды") и доски на них.

## Конфиг

Параметры в конфиге (по крайней мере, которые стоит трогать) описаны прямо в нём.

## Админка

По сравнению с обычной кусабой в админке есть специальные пункты:
- пересоздать статическую карту ответов: так как карта ответов, в отличие от обычной 0chan-кусабы в курисабе статическая, то после массивных правок досок (к примеру, переноса тредов или влива дампа базы) она может сломаться, тогда следует выбрать этот пункт.
- сбросить лимит тредов: с целью защиты от вайпа в день можно создать не более KU_MAXTHREADSADAY тредов. Если нужно создать больше, то нужно выбрать этот пункт, и тогда отсчет KU_MAXTHREADSADAY пойдет с текущего момента, а не 24 часов до него, и можно будет создать новые KU_MAXTHREADSADAY тредов.
- специальные треды. О них ниже.
Есть также пункт "подневная статистика по бордам /sg/ и /vg/" - его вообще можно выпилить или переделать так, как надо (этот пункт специфичен для "Курисача", первой и, собственно, родной борды для курисабы).

## Специальные треды

Некоторые треды могут быть доступны по коротким ссылкам. Таких тредов четыре (так исторически сложилось). Это:
- рандом-тред (применительно к обычным бордам, по смыслу это что-то вроде "самый посещаемый тред в /b/").
- сырно-тред (по сути, второй рандом).
- FAQ (говорит сам за себя). Его ещё логично заблокировать и спрятать, чтобы он мог быть доступен только по ссылке, но не светился на борде.
- /d/-тред (нечто типа "основной тред багов и предложений в /d/").
Этим четырём тредам жёстко назначены специальные ссылки "/sg/sg/", "/9/", "/faq/" и "/d/" соответственно. Это можно (и для борды, не являющейся Курисачем, нужно) поправить в error.php.

Кроме того, можно добавить другие подобные ссылки в "списке тредов для меню" на странице "специальные треды" админки.

Формат записи:
```
{ SPECIALTHREAD { /sg/sg/ | /faq/ | /d/ | /9/ } | THREAD thread-id } /link/ Thread-Name
```
Здесь:
- первый аргумент - тип треда (один из четырёх специальных или обычный),
- второй аргумент - id ОП-поста, если тред обычный, или соответствующая треду специальная ссылка,
- третий - это ссылка, по которой он будет доступен (для специальных тредов должна повторять второй аргумент),
- и четвёртый - имя треда, под которым он появляется в меню.
Каждый блок записей THREAD/SPECIALTHREAD должна предварять строка вида BOARD boardname, где boardname - имя доски (без слэшей). Эта строка показывает, к какой борде относятся последующие треды.

К примеру, если там написано:
```
BOARD b
THREAD 12345 /vid/ Video Thread
```
то это означает, что в тред можно зайти как по обычной ссылке вида http://example.com/b/res/12345.html, так и по ссылке http://example.com/vid/.

Очевидно, названия имеющихся досок не должны совпадать с подобными ссылками на треды.

Кроме того, в меню появится соответствующая ссылка на этот тред.

## Пару слов про лицензию

Основная лицензия проекта - GPLv2.

Однако, поскольку как сама Kusaba X, так и 0chan-Kusaba в своём составе имеет много компонентов и там могут возникать проблемы с лицензиями, то для курисабы эта болезнь тоже справедлива.

Возможно, некоторые файлы, на основе которых генерируется главная страница (front.php), не обладают лицензионной чистотой - надо проверять. В любом случае главную на каждой борде нужно делать самому, а тут используется главная от "Курисача".